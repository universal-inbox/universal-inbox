default:
    @just --choose

@build:
    docker-compose build universal-inbox

@publish:
    docker buildx ls | grep -q ^universal-inbox || docker buildx create --use --driver docker-container --name universal-inbox
    docker buildx build \
      --builder universal-inbox \
      --push \
      --platform linux/amd64,linux/arm64 \
      -t dax42/universal-inbox:$(git rev-parse HEAD) \
      -t dax42/universal-inbox:latest \
      --label service="universal-inbox" \
      --file ../Dockerfile \
      ..
    echo "ðŸš€ Docker image dax42/universal-inbox published with tag $(git rev-parse HEAD)"
