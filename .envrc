# export PGDATA="$PWD/.devbox/virtenv/postgresql_17/data"
export DATABASE_URL="postgres://postgres:password@127.0.0.1:5432/universal-inbox"
export SQLX_OFFLINE="true"
# Serde has difficulties deserialize large nested structs on smaller stack
# This is required for tests
export RUST_MIN_STACK=104857600
export RUST_BACKTRACE=full
export VERSION=dev
# Don't run tests by default on git hook. Use `just check-commit` to include tests.
export SKIP=test

# Automatically sets up your devbox environment whenever you cd into this
# directory via our direnv integration:

eval "$(devbox generate direnv --print-envrc)"

# check out https://www.jetpack.io/devbox/docs/ide_configuration/direnv/
# for more details

# Android SDK / NDK / Java environment for Dioxus mobile builds
# The SDK is provided by tadfisher/android-nixpkgs via android-sdk-flake/
# These must be set after devbox generates the environment
export ANDROID_HOME="$PWD/.devbox/nix/profile/default/share/android-sdk"
export ANDROID_SDK_ROOT="$ANDROID_HOME"
# NDK is included inside the SDK (tadfisher/android-nixpkgs bundles it)
NDK_DIR=$(ls -d "$ANDROID_HOME/ndk/"* 2>/dev/null | head -1)
if [ -n "$NDK_DIR" ]; then
  export NDK_HOME="$NDK_DIR"
  export ANDROID_NDK_HOME="$NDK_HOME"
fi
export JAVA_HOME="$(dirname "$(dirname "$(realpath "$(which java)")")")"

dotenv_if_exists .env

source_env_if_exists .local_envrc

if [ -n "$WORKTRUNK_ZELLIJ_SESSION" ] && [ -z "$ZELLIJ" ]; then
    zellij attach "$WORKTRUNK_ZELLIJ_SESSION"
fi
